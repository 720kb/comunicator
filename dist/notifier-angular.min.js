/*
 * notifier - v0.0.1
 *
 * The 720kb notifier api (atm it uses websockets)
 * 2015-01-25
 */


!function(){"use strict";for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;c+=1)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){window.clearTimeout(a)})}(),function(a,b){"use strict";a.module("720kb.notifier",[]).provider("Notifier",function(){var a,c,d=function(c){c?(a=new b.WebSocket(c),a.onopen=function(){b.console.info("Trasport",this,"opened.")}):b.console.error("Please provide a valid URL."),a.push=a.send};return{setNotifierServerURL:d,$get:["$window","$rootScope","$log","$q",function(b,e,f,g){c=g.defer();for(var h,i,j,k,l=function(c,d){a.readyState===b.WebSocket.OPEN?a.push(JSON.stringify({opcode:c,token:j,data:d})):(f.info("Trasport to server is not ready."),b.requestAnimationFrame(a.send.apply(this,[c,d])))},m=function(a){var b=JSON.parse(a.data);"joined"===b.opcode?e.$emit("notifier:joined"):"sent"===b.opcode?e.$emit("notifier:toMe",b):"broadcasted"===b.opcode&&e.$emit("notifier:toAll",b)},n=function x(){a.readyState===b.WebSocket.OPEN?a.push(JSON.stringify({opcode:"join",whoami:i,token:j})):a.readyState===b.WebSocket.CLOSED?(d(a.url),a.send=l,a.onmessage=m,x()):(f.info("Trasport to server is not yet ready. Retry..."),b.requestAnimationFrame(x))},o=function(a,b){i=a,j=b,i&&j?n():f.error("User identification datas missing.")},p=function(b){if(i&&a){var c={whoami:i,who:"*",what:b};a.send("broadcast",c)}else f.error("User identification required")},q=function(b,c){if(i&&a){var d={whoami:i,who:b,what:c};a.send("sendTo",d)}else f.error("User identification required")},r=function(){a.readyState===b.WebSocket.OPEN&&a.close()},s=["$stateChangeSuccess","$routeChangeSuccess"],t=[],u=s.length,v=0,w=function(){for(var a=0,b=t.length;b>a;a+=1)t[a]();c.resolve({userIsPresent:o,broadcast:p,sendTo:q,exit:r})};u>v;v+=1)k=s[v],t.push(e.$on(k,w));return a||(h="Mandatory field notifierServerURL required",f.error(h,a),c.reject(h)),a.send=l,a.onmessage=m,c.promise}]}})}(angular,window);
//# sourceMappingURL=notifier-angular.min.js.map