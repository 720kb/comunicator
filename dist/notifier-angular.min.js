/*
 * notifier - v0.0.1
 *
 * The 720kb notifier api (atm it uses websockets)
 * 2014-11-05
 */


!function(a,b){"use strict";a.module("720kb.notifier",[]).provider("Notifier",function(){var a;return{setNotifierServerURL:function(c){c?(a=new b.WebSocket(c),a.onopen=function(){b.console.info("Trasport",this,"opened.")}):b.console.error("Please provide a valid URL.")},$get:["$window","$rootScope",function(b,c){var d,e,f,g=function k(){a.readyState===b.WebSocket.OPEN?a.push(JSON.stringify({opcode:"join",whoami:e,token:f})):(b.console.info("Trasport to server is not yet ready. Retry..."),b.requestAnimationFrame(k))},h=function(a,c){e=a,f=c,e&&f?g():b.console.error("User identification datas missing.")},i=function(c){if(e&&a){var d={whoami:e,who:"*",what:c};a.send("broadcast",d)}else b.console.error("User identification required")},j=function(c,d){if(e&&a){var f={whoami:e,who:c,what:d};a.send("sendTo",f)}else b.console.error("User identification required")};if(!a)throw d="Mandatory field notifierServerURL required",b.console.error(d,a),d;return a.push=a.send,a.send=function(c,d){a.readyState===b.WebSocket.OPEN?a.push(JSON.stringify({opcode:c,token:f,data:d})):(b.console.info("Trasport to server is not ready."),b.requestAnimationFrame(a.send.apply(this,[c,d])))},a.onmessage=function(a){var b=JSON.parse(a.data);"joined"===b.opcode?c.$emit("notifier:joined"):"sent"===b.opcode?c.$emit("notifier:toMe",b):"broadcasted"===b.opcode&&c.$emit("notifier:toAll",b)},{userIsPresent:h,broadcast:i,sendTo:j}}]}})}(angular,window);
//# sourceMappingURL=notifier-angular.min.js.map